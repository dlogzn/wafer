<!doctype html>
<html lang="en">
<head>
	<title>Die Per Wafer</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="assets/images/icon.webp" sizes="32x32">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.2.min.js"></script>

	<link href="assets/css/style.css" rel="stylesheet">

	<link href='https://fonts.googleapis.com/css?family=Cuprum' rel='stylesheet'>


</head>
<body>

<div class="container-fluid">
	<div class="row mt-5">
		<div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-12 mx-auto">
			<h4 class="text-secondary text-center mb-5">Die Per Wafer (free) Calculator – Trusted by GF and Amkor</h4>


			<form id="die_per_wafer_form">
				<div class="row">
					<div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-4 mb-4 mb-xxl-0">
						<div class="row">
							<div class="col-5"><label for="die_width" class="text_color_default">Die Width</label></div>
							<div class="col-7">
								<div class="input-group">
									<input type="text" class="form-control rounded-0 border-end-0" name="die_width" id="die_width" value="10">
									<span class="input-group-text rounded-0 border-start-0 bg-white text_color_a">mm</span>
								</div>
							</div>
						</div>
						<div class="row mt-4">
							<div class="col-5"><label for="die_height" class="text_color_default">Die Height</label></div>
							<div class="col-7">
								<div class="input-group">
									<input type="text" class="form-control rounded-0 border-end-0" name="die_height" id="die_height" value="10">
									<span class="input-group-text rounded-0 border-start-0 bg-white text_color_a">mm</span>
								</div>
							</div>
						</div>
						<div class="row mt-4">
							<div class="col-5"><label for="wafer_diameter" class="text_color_default">Wafer Diameter</label></div>
							<div class="col-7">
								<div class="input-group">
									<input type="text" class="form-control rounded-0 border-end-0" name="wafer_diameter" id="wafer_diameter" value="300">
									<span class="input-group-text rounded-0 border-start-0 bg-white text_color_a">mm</span>
								</div>
							</div>
						</div>

						<div class="row mt-4">
							<div class="col-5"><label for="width_of_x_scribe_line" class="text_color_default">Width of X Scribe Line</label></div>
							<div class="col-7">
								<div class="input-group">
									<input type="text" class="form-control rounded-0 border-end-0" name="width_of_x_scribe_line" id="width_of_x_scribe_line" value="0">
									<span class="input-group-text rounded-0 border-start-0 bg-white text_color_a">µm</span>
								</div>
							</div>
						</div>
						<div class="row mt-4">
							<div class="col-5"><label for="width_of_y_scribe_line" class="text_color_default">Width of Y Scribe Line</label></div>
							<div class="col-7">
								<div class="input-group">
									<input type="text" class="form-control rounded-0 border-end-0" name="width_of_y_scribe_line" id="width_of_y_scribe_line" value="0">
									<span class="input-group-text rounded-0 border-start-0 bg-white text_color_a">µm</span>
								</div>
							</div>
						</div>
						<div class="row mt-4">
							<div class="col-5"><label for="wafer_edge_exclusion" class="text_color_default">Wafer Edge Exclusion</label></div>
							<div class="col-7">
								<div class="input-group">
									<input type="text" class="form-control rounded-0 border-end-0" name="wafer_edge_exclusion" id="wafer_edge_exclusion" value="0">
									<span class="input-group-text rounded-0 border-start-0 bg-white text_color_a">mm</span>
								</div>
							</div>
						</div>
						<div class="mt-4 text-end">
							<button type="submit" class="btn btn-sm btn-outline-info border-0 rounded-0 py-2 px-3" style="background-color: #cd2727; border-color: #b11a1a; background-image: linear-gradient(to top,rgba(0,0,0,.1),rgba(255,255,255,.1)); color: white;">Re-calculate</button>
						</div>

					</div>
					<div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 col-xxl-8">
						<div class="border text-center p-4">
							<h5 class="text-black text-center">The Generated Wafer</h5>
							<div id="wafer_image"></div>
							<img id="logo" src="assets/images/logo.webp" alt="The Logo" class="d-none">
						</div>
					</div>
				</div>

			</form>




		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function () {
		$('#die_per_wafer_form').submit();
	});

	let points = [];

	$(document).on('submit', '#die_per_wafer_form', function (event) {
		event.preventDefault();
		let waferDiameter = parseFloat($('#wafer_diameter').val()) * 2;
		let waferRadius = waferDiameter / 2;
		let dieWidth = parseFloat($('#die_width').val()) * 2;
		let dieHeight = parseFloat($('#die_height').val()) * 2;
		let waferEdgeExclusion = parseFloat($('#wafer_edge_exclusion').val()) * 2;


		$('#wafer_image').empty().append(`
		    <canvas id="wafer" class="img-fluid" width="` + (waferDiameter + waferEdgeExclusion) + `" height="` + (waferDiameter + waferEdgeExclusion + 25) + `" style="background-color:#fff;"></canvas>
		`);

		const canvas = document.getElementById('wafer');
		if (canvas.getContext) {
			const ctx = canvas.getContext('2d');
			let logo = document.getElementById("logo");

			ctx.drawImage(logo, waferRadius - 50, waferDiameter + 5);

			if (waferEdgeExclusion > 0) {
				drawOuterCircle(waferRadius + (waferEdgeExclusion/2));
			}

			drawInnerCircle(waferRadius);

			function drawOuterCircle(radius){
				ctx.beginPath();
				ctx.arc(radius, radius, radius, 0, 2 * Math.PI, false);
				ctx.fillStyle = '#fdfdfd';
				ctx.fill();
				ctx.lineWidth = 1;
				ctx.strokeStyle = '#ccc';
				ctx.stroke();
			}

			function drawInnerCircle(radius){
				ctx.beginPath();
				ctx.arc(radius + (waferEdgeExclusion/2), radius + (waferEdgeExclusion/2), radius, 0, 2 * Math.PI, false);
				ctx.fillStyle = '#fdfdfd';
				ctx.fill();
				ctx.lineWidth = 1;
				ctx.strokeStyle = '#ccc';
				ctx.stroke();
			}

			let dpw = Math.ceil((waferDiameter * Math.PI) * (waferDiameter / (4 * (dieWidth * dieHeight)) - 1 / Math.sqrt(2 * (dieWidth * dieHeight))));
			console.log(dpw);

			let grd = ctx.createLinearGradient(0, 0, 0, waferDiameter);
			grd.addColorStop(0, 'rgba(255, 125, 125, 1)');
			grd.addColorStop(1, 'rgba(125, 125, 255, 1)');

			let count = 0;
			let x;
			let y = waferRadius - (dieWidth / 2);

			for (let j=0; j<=waferDiameter; j=j+dieWidth) {
				x = j;
				let circle={x:waferRadius, y:waferRadius, r:waferRadius};
				let rect={x:x, y:y, w:dieWidth, h:dieHeight};
				if (count < dpw && RectCircleColliding(circle, rect) === true) {
					count++;
					ctx.beginPath();
					ctx.rect(x, y, dieWidth, dieHeight);
					ctx.fillStyle = grd;
					ctx.fill();
					ctx.lineWidth = 1;
					ctx.strokeStyle = '#fafafa';
					ctx.stroke();
				}
			}

			y = (waferDiameter / 2) - (dieWidth / 2);
			while(y > 0) {
				y = y - dieHeight;
				for (let j=0; j<=waferDiameter; j=j+dieWidth) {
					x = j;
					let circle={x:waferRadius, y:waferRadius, r:waferRadius};
					let rect={x:x, y:y, w:dieWidth, h:dieHeight};
					if (count < dpw && RectCircleColliding(circle, rect) === true) {
						count++;
						ctx.beginPath();
						ctx.rect(x, y, dieWidth, dieHeight);
						ctx.fillStyle = grd;
						ctx.fill();
						ctx.lineWidth = 1;
						ctx.strokeStyle = '#fafafa';
						ctx.stroke();
					}
				}
			}


			y = (waferDiameter / 2) - (dieWidth / 2);
			while(y < waferDiameter) {
				y = y + dieHeight;
				for (let j=0; j<=waferDiameter; j=j+dieWidth) {
					x = j;
					let circle={x:waferRadius, y:waferRadius, r:waferRadius};
					let rect={x:x, y:y, w:dieWidth, h:dieHeight};
					if (count < dpw && RectCircleColliding(circle, rect) === true) {
						count++;
						ctx.beginPath();
						ctx.rect(x, y, dieWidth, dieHeight);
						ctx.fillStyle = grd;
						ctx.fill();
						ctx.lineWidth = 1;
						ctx.strokeStyle = '#fafafa';
						ctx.stroke();
					}
				}
			}
		}

	});

	function RectCircleColliding(circle,rect){
		if (
				distance(rect.x, rect.y, circle) < circle.r &&
				distance(rect.x + rect.w, rect.y, circle) < circle.r &&
				distance(rect.x + rect.w, rect.y + rect.h, circle) < circle.r &&
				distance(rect.x, rect.y + rect.h, circle) < circle.r
		) {
			return true;
		} else {
			return false;
		}
	}

	function distance(ptX, ptY, circle) {
		return Math.hypot(ptX - circle.x, ptY - circle.y);
	}

</script>

</body>
</html>




<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--	<meta charset="utf-8">-->
<!--	<meta name="viewport" content="width=device-width, initial-scale=1">-->
<!--	<title></title>-->
<!--	<style type="text/css">-->
<!--		canvas {-->
<!--  position: absolute;-->
<!--  height: 150px;-->
<!--  width: 150px;-->
<!--  top: 50%;-->
<!--  left: 50%;-->
<!--  transform: translate(-50%, -50%);-->
<!--}-->
<!--	</style>-->
<!--</head>-->
<!--<body onload="draw()">-->
<!--  <div style="text-align:center;" , style="position: absolute">-->
<!--    <canvas id="circle" width="150" height="150"></canvas>-->
<!--  </div>-->

<!--<script type="text/javascript">-->
<!--	function draw() {-->
<!--		-->
<!--	}-->
<!--	-->
<!--</script>-->

<!--</body>-->
<!--</html>-->